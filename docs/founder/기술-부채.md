# Tech Debt Registry (기술 부채 목록)

> **목적**: 알려진 기술 부채를 추적하고, 심각도와 해결 시점을 관리합니다.
> **규칙**: 매 Day 완료 시 Cowork이 업데이트. 주간 리뷰에서 Gen이 "이번 주 위험 예산"을 결정.
> **심각도**: 🔴 높음 (파일럿 전 해결 필수) | 🟡 중간 (Phase 1 내 해결 권장) | 🟢 낮음 (Phase 2로 이월 가능)

---

## 현재 부채 요약

| # | 항목 | 심각도 | 등록일 | 해결 기한 | 상태 |
|---|------|--------|--------|-----------|------|
| TD-001 | 인메모리 Rate Limiting | 🟡 중간 | W2 D7 | Phase 1 후반 | 미해결 |
| TD-002 | 알림 자동 스케줄러 미구현 | 🟡 중간 | W2 D6 | W4 | 미해결 |
| TD-003 | 외부 알림 채널 미연동 | 🟢 낮음 | W2 D6 | W5 | 미해결 |
| TD-004 | 테스트 커버리지 부족 | 🟡 중간 | W2 D6 | 지속 | 부분 해결 |
| TD-005 | CLAUDE.md에 Playwright 미등록 | 🟢 낮음 | W2 D7 | D8 | 미해결 |
| TD-006 | PII 중복 검사 성능 | 🟢 낮음 | W2 D5 | Phase 2 | 미해결 |
| TD-007 | 배포 환경 미확정 | 🔴 높음 | W1 | W4 | 미해결 |
| TD-008 | W0 외부 의존성 미확보 | 🔴 높음 | W0 | W3 | 진행 중 |

---

## 상세 설명

### TD-001: 인메모리 Rate Limiting 🟡
- **위치**: `src/app/api/chat/route.ts`
- **현재 상태**: 챗봇 API의 요청 제한(30회/5분)이 서버 메모리에 저장됨.
- **문제**: 서버가 재시작되면 제한 카운터가 초기화됨. 서버가 여러 대이면 각각 별도 카운터 → 실질적으로 제한이 안 됨.
- **해결 방법**: Redis로 rate limit 카운터를 관리하면 서버 재시작/다중 서버에서도 유지됨.
- **파일럿 영향**: 파일럿은 서버 1대이므로 당장 문제 없음. 하지만 서버 재시작 시 잠깐 무방비.

> **각주: Rate Limiting이란?**
> "특정 시간 내 요청 횟수를 제한"하는 것. 예: 1명이 5분에 30번만 메시지를 보낼 수 있음. 없으면 봇이나 악의적 사용자가 API를 수천 번 호출하여 서버를 마비시킬 수 있음(DDoS 공격).

> **각주: Redis란?**
> 매우 빠른 인메모리 데이터 저장소. DB보다 빠르고, 서버 메모리와 달리 독립적으로 운영됨. "공유 메모장"이라고 생각하면 됨 — 여러 서버가 같은 메모장을 참조.

### TD-002: 알림 자동 스케줄러 미구현 🟡
- **위치**: `src/app/api/alerts/generate/route.ts`
- **현재 상태**: 알림 생성이 담당자의 "알림 생성" 버튼 클릭에 의존.
- **문제**: 담당자가 버튼을 안 누르면 비자 만료 경고가 생성되지 않음. 주말/공휴일에 아무도 안 누르면 D-3 알림이 D-1에야 생성됨.
- **해결 방법**: Vercel Cron Job (매일 09:00 자동 실행) 또는 외부 스케줄러(AWS EventBridge).
- **파일럿 영향**: 담당자에게 "매일 아침 알림 생성 버튼을 눌러주세요"라고 안내 필요. 운영 부담.

> **각주: Cron Job이란?**
> "정해진 시간에 자동으로 실행되는 작업". 예: "매일 오전 9시에 알림 생성 API를 자동 호출". 사람이 버튼을 누를 필요 없음.

### TD-003: 외부 알림 채널 미연동 (이메일/카카오/SMS) 🟢
- **위치**: `src/lib/notification-service.ts`
- **현재 상태**: IN_APP 알림만 실제 동작. EMAIL, KAKAO, SMS는 함수 시그니처만 존재(placeholder).
- **문제**: 학생에게 직접 연락하는 수단이 없음. 모든 알림이 대시보드 내부에만 표시됨.
- **해결 방법**: AWS SES (이메일), Kakao BizMessage API, SMS API 연동.
- **파일럿 영향**: 파일럿 초기에는 IN_APP으로 충분할 수 있으나, 학생 대상 알림(비자 만료 경고 등)은 이메일/카카오가 필요.

### TD-004: 테스트 커버리지 부족 🟡
- **현재 상태**:
  - ✅ 트래픽 라이트 유닛 테스트: 25개
  - ✅ PII 마스킹 유닛 테스트: 11개
  - ✅ Playwright E2E: 3개
  - ❌ API 라우트 통합 테스트: 0개
  - ❌ 임포트 파이프라인 E2E 테스트: 0개
  - ❌ 챗봇 인텐트 분류 정확도 테스트: 0개
- **문제**: 핵심 비즈니스 로직(임포트, FIMS 내보내기)에 테스트가 없어서, 코드 수정 시 기존 기능이 깨졌는지 자동 확인 불가.
- **해결 방법**: 최소한 API 라우트별 happy path 테스트 + 임포트 E2E 테스트 추가.
- **파일럿 영향**: 현재까지는 수동 검증으로 커버. 하지만 코드가 커질수록 수동 검증만으로 부족.

> **각주: "happy path 테스트"란?**
> 모든 것이 정상적으로 동작하는 시나리오만 테스트하는 것. "비밀번호 맞게 입력 → 로그인 성공" 같은 기본 흐름. 반대는 "edge case 테스트" — "비밀번호 100자 입력하면 어떻게 되나?" 같은 예외 상황.

### TD-005: CLAUDE.md에 Playwright 미등록 🟢
- **현재 상태**: Day 7에서 Playwright가 추가되었으나 CLAUDE.md 기술 스택에 미반영.
- **문제**: Claude Code가 기술 스택을 참조할 때 Playwright를 "승인된 도구"로 인식하지 못할 수 있음.
- **해결 방법**: Day 8 Task 0에 포함됨.

### TD-006: PII 중복 검사 성능 🟢
- **위치**: `src/app/api/import/validate/route.ts`
- **현재 상태**: 임포트 시 중복 검사를 위해 기존 학생 전체의 여권번호를 복호화하여 비교.
- **문제**: 학생 수 10,000+에서 복호화 시간이 수십 초 이상 걸릴 수 있음.
- **해결 방법**: 해시 인덱스 컬럼 추가 (passportHash — SHA-256 단방향 해시를 별도 저장).
- **파일럿 영향**: 파일럿 규모(~1,000명)에서는 문제 없음.

### TD-007: 배포 환경 미확정 🔴
- **현재 상태**: 로컬 개발 환경에서만 실행 중. 배포 대상(Vercel+Supabase vs AWS)이 미결정.
- **문제**: W4 보안 감사에서 "실제 운영 환경에서 어떻게 보안이 유지되는가"를 검증해야 하는데, 환경이 없으면 검증 불가.
- **해결 방법**: Gen이 배포 환경 결정 후, 스테이징 환경 구축.
- **파일럿 영향**: 🔴 파일럿 전 반드시 해결 필요.

### TD-008: W0 외부 의존성 미확보 🔴
- **현재 상태**: 파일럿 대학(호서대/선문대/순천향대) 컨택 진행 중.
- **필요한 것**:
  - [ ] FIMS 실제 양식 (내보내기 템플릿 정확도 검증용)
  - [ ] 파일럿 대학의 실제 학생 데이터 샘플 (임포트 테스트용)
  - [ ] 대학 담당자 워크플로우 확인 (UI가 실제 업무와 맞는지)
- **문제**: FIMS 양식 없이 만든 내보내기 템플릿은 실제 FIMS와 다를 수 있음. 나중에 전면 수정 가능.
- **파일럿 영향**: 🔴 W3 FIMS 내보내기 기능의 정확도를 보장할 수 없음.

---

## 해결 완료

| # | 항목 | 해결일 | 해결 방법 |
|---|------|--------|-----------|
| (아직 없음) | | | |

---

## 주간 위험 예산 기록

> Gen이 매주 결정: "이번 주 새 기능 N개, 부채 해소 N개"

| 주차 | 새 기능 | 부채 해소 | Gen 판단 |
|------|---------|-----------|----------|
| W1 | Dashboard, Students, TL, Calendar | (없음) | 기능 우선 |
| W2 | Import, Alerts, Chatbot, Tests | TD-004 부분 해결 (테스트 추가) | 기능 우선 + 테스트 시작 |
| W3 | (미정 — Gen 결정 필요) | (미정) | ⬅️ 여기서부터 새 워크플로우 |
